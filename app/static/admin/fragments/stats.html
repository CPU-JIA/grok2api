<main class="space-y-6 flex-1 container mx-auto max-w-6xl px-6 py-8 fade-in">
  <div class="space-y-6">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="page-title">统计监控</h2>
        <p class="page-subtitle">查看请求统计和审计日志。</p>
      </div>
      <div class="flex items-center gap-3">
        <div class="stats-tabs" role="tablist" aria-label="统计分类">
          <button
            class="stats-tab active"
            data-tab="request"
            role="tab"
            aria-selected="true"
          >
            <span class="stats-tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M3 3v18h18"></path>
                <path d="m7 14 4-4 3 3 5-6"></path>
              </svg>
            </span>
            <span class="stats-tab-label">请求统计</span>
          </button>
          <button
            class="stats-tab"
            data-tab="logs"
            role="tab"
            aria-selected="false"
          >
            <span class="stats-tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path
                  d="M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"
                ></path>
                <path d="M8 9h8"></path>
                <path d="M8 13h8"></path>
                <path d="M8 17h5"></path>
              </svg>
            </span>
            <span class="stats-tab-label">日志审计</span>
          </button>
        </div>

        <button
          id="stats-refresh-btn"
          class="geist-button-outline gap-2 stats-refresh-btn"
        >
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
            <path d="M3 3v5h5" />
            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
            <path d="M16 21h5v-5" />
          </svg>
          刷新数据
        </button>
      </div>
    </div>

    <section id="stats-panel-request" class="space-y-6">
      <div class="grid grid-cols-2 xl:grid-cols-4 gap-4">
        <div class="stat-card stats-stat-card">
          <div class="stat-value" id="stat-total-req">0</div>
          <div class="stat-label">总请求数</div>
        </div>
        <div class="stat-card stats-stat-card">
          <div class="stat-value stats-ok" id="stat-success-req">0</div>
          <div class="stat-label">成功</div>
        </div>
        <div class="stat-card stats-stat-card">
          <div class="stat-value stats-fail" id="stat-failed-req">0</div>
          <div class="stat-label">失败</div>
        </div>
        <div class="stat-card stats-stat-card">
          <div class="stat-value stats-rate" id="stat-success-rate">0%</div>
          <div class="stat-label">成功率</div>
        </div>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <article class="chart-card">
          <div class="chart-title">24小时请求趋势</div>
          <div class="chart-container">
            <canvas id="chart-hourly" height="220"></canvas>
          </div>
        </article>
        <article class="chart-card">
          <div class="chart-title">7天趋势（请求量 + 成功率）</div>
          <div class="chart-container">
            <canvas id="chart-daily" height="220"></canvas>
          </div>
        </article>
      </div>
      <div class="chart-card chart-card-models">
        <div class="chart-title">模型调用分布 (Top 10)</div>
        <div class="models-layout" aria-label="模型调用分布">
          <div class="model-donut-wrap">
            <canvas id="chart-models" height="280"></canvas>
            <div class="model-donut-center" aria-live="polite">
              <div id="models-center-main" class="model-donut-center-main">
                -
              </div>
              <div id="models-center-sub" class="model-donut-center-sub">
                调用: 0 次 (0%)
              </div>
            </div>
          </div>
          <div
            id="models-legend"
            class="model-donut-legend-panel"
            role="list"
          ></div>
        </div>
      </div>
      <div class="stats-request-footer">
        <button
          id="stats-reset-btn"
          class="geist-button-outline stats-reset-btn"
        >
          重置统计
        </button>
      </div>
    </section>

    <section id="stats-panel-logs" class="space-y-4 hidden">
      <div class="logs-head">
        <div class="logs-info">
          <div class="logs-summary" id="logs-summary">
            显示 0 / 0 条请求记录
          </div>
          <div class="logs-summary-sub" id="logs-summary-sub">
            按时间倒序展示，点击行查看详情
          </div>
        </div>
        <div class="logs-head-actions">
          <div
            class="logs-filter-tabs"
            role="tablist"
            aria-label="日志状态筛选"
          >
            <button
              class="logs-filter-btn active"
              data-filter="all"
              role="tab"
              aria-selected="true"
            >
              全部 <span class="logs-filter-count" id="logs-filter-all">0</span>
            </button>
            <button
              class="logs-filter-btn"
              data-filter="success"
              role="tab"
              aria-selected="false"
            >
              成功
              <span
                class="logs-filter-count logs-filter-count-success"
                id="logs-filter-success"
                >0</span
              >
            </button>
            <button
              class="logs-filter-btn"
              data-filter="error"
              role="tab"
              aria-selected="false"
            >
              失败
              <span
                class="logs-filter-count logs-filter-count-error"
                id="logs-filter-error"
                >0</span
              >
            </button>
          </div>
          <button id="logs-clear-btn" class="logs-clear-btn">清空日志</button>
        </div>
      </div>

      <div
        class="stats-logs-wrap rounded-lg overflow-hidden bg-white overflow-x-auto"
      >
        <table class="geist-table stats-logs-table min-w-[900px]">
          <thead>
            <tr>
              <th class="text-left w-32">时间</th>
              <th class="text-left w-28">IP</th>
              <th class="text-left w-48">模型</th>
              <th class="text-center w-24">耗时</th>
              <th class="text-center w-24">状态</th>
              <th class="text-left w-32">Key</th>
              <th class="text-left min-w-[200px]">错误信息</th>
            </tr>
          </thead>
          <tbody id="logs-table-body"></tbody>
        </table>
        <div id="logs-empty" class="hidden table-empty">暂无日志记录</div>
      </div>

      <!-- Pagination -->
      <div class="logs-pagination">
        <div id="logs-pagination-info" class="text-xs text-[var(--accents-5)]">
          第 0 / 0 页 · 共 0 条
        </div>
        <div class="flex items-center gap-2">
          <button
            id="logs-page-first"
            class="geist-button-outline text-xs px-3"
            onclick="logsGoFirstPage()"
          >
            首页
          </button>
          <button
            id="logs-page-prev"
            class="geist-button-outline text-xs px-3"
            onclick="logsGoPrevPage()"
          >
            上一页
          </button>
          <button
            id="logs-page-next"
            class="geist-button-outline text-xs px-3"
            onclick="logsGoNextPage()"
          >
            下一页
          </button>
          <button
            id="logs-page-last"
            class="geist-button-outline text-xs px-3"
            onclick="logsGoLastPage()"
          >
            末页
          </button>
          <select
            id="logs-page-size"
            class="geist-input h-[30px]"
            onchange="logsChangePageSize()"
          >
            <option value="20">20 / 页</option>
            <option value="50" selected>50 / 页</option>
            <option value="100">100 / 页</option>
          </select>
        </div>
      </div>
    </section>
  </div>
</main>
